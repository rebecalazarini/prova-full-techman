<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Equipamentos - Admin</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #eef2f3; }
    header { background: #44babc; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; font-size: 24px; }
    header button { padding: 8px 12px; border: none; border-radius: 6px; background: #35797d; color: white; cursor: pointer; }
    main { padding: 20px; max-width: 900px; margin: 0 auto; }
    .equipamento { background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
    .equipamento img { max-width: 100%; height: auto; border-radius: 5px; margin-bottom: 10px; }
    .comentarios { margin-top: 10px; padding-left: 15px; }
    .comentario { background: #f0f0f0; margin-bottom: 5px; padding: 5px 8px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
    .btn { cursor: pointer; padding: 5px 8px; border: none; border-radius: 5px; color: white; }
    .btn-excluir { background: #dc3545; }
    .ver-comentarios { margin-top: 10px; background: #44babc; color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Admin - Equipamentos</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <main id="equipamentos-list">
    <!-- Lista de equipamentos ser치 renderizada aqui -->
  </main>

  <script>
    const API_URL = "http://localhost:3000";

    async function fetchEquipamentos() {
      try {
        const response = await fetch("http://localhost:3000/equipamento");
        const equipamentos = await response.json();
        const list = document.getElementById("equipamentos-list");
        list.innerHTML = "";

        equipamentos.forEach(e => {
          const div = document.createElement("div");
          div.className = "equipamento";

          div.innerHTML = `
            <h2>${e.equipamento}</h2>
            <img src="${e.imagem}" alt="${e.equipamento}">
            <p>${e.descricao}</p>
            <button class="ver-comentarios" onclick="toggleComentarios(this)">Ver Coment치rios</button>
            <button class="btn btn-excluir" onclick="excluirEquipamento(${e.id})">Excluir Equipamento</button>
            <div class="comentarios" style="display:none;">
              ${(e.comentarios || []).map(c => `
                <div class="comentario">
                  ${c.comentario}
                  <button class="btn btn-excluir" onclick="excluirComentario(${c.id}, this)">X</button>
                </div>
              `).join('')}
            </div>
          `;
          list.appendChild(div);
        });
      } catch (error) {
        console.error("Erro ao carregar equipamentos:", error);
      }
    }

    function toggleComentarios(btn) {
      const comentarios = btn.nextElementSibling.nextElementSibling; // Pega a div correta
      comentarios.style.display = comentarios.style.display === "none" ? "block" : "none";
    }

    function logout() {
      window.location.href = "index.html"; 
    }

    async function excluirEquipamento(id) {
      if(!confirm("Deseja realmente excluir este equipamento?")) return;
      try {
        await fetch(`${API_URL}/equipamento/${id}`, { method: "DELETE" });
        fetchEquipamentos();
      } catch (err) {
        console.error("Erro ao excluir equipamento:", err);
      }
    }
    async function excluirComentario(id, btn) {
      if(!confirm("Deseja realmente excluir este coment치rio?")) return;
      try {
        await fetch(`${API_URL}/comentario/${id}`, { method: "DELETE" });
        btn.parentElement.remove();
      } catch (err) {
        console.error("Erro ao excluir coment치rio:", err);
      }
    }

    fetchEquipamentos();
  </script>
</body>
</html>
